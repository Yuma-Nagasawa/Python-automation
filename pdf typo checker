import fitz  # PyMuPDF
import pytesseract
from PIL import Image
import io

# PDFファイルのパス
pdf_path = "sample.pdf"

# PDFを開く
doc = fitz.open(pdf_path)

# OCRの結果を格納するリスト
ocr_results = []

for page_num in range(len(doc)):
    page = doc[page_num]
    images = page.get_images(full=True)  # 画像を取得

    for img_index, img in enumerate(images):
        xref = img[0]  # 画像の参照ID
        base_image = doc.extract_image(xref)
        image_bytes = base_image["image"]
        img = Image.open(io.BytesIO(image_bytes))

        # OCRで画像内のテキストを抽出
        text = pytesseract.image_to_string(img, lang="eng")  # 日本語なら "jpn"
        
        ocr_results.append({
            "Page": page_num + 1,
            "Image_Index": img_index + 1,
            "Extracted_Text": text.strip()
        })

# OCR結果を表示
import pandas as pd
import ace_tools as tools
df = pd.DataFrame(ocr_results)
tools.display_dataframe_to_user(name="OCR抽出結果", dataframe=df)

# PDFを閉じる
doc.close()
